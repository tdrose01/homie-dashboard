<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenClaw Command Center</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg: #0a0a0f;
            --card: rgba(20, 20, 28, 0.7);
            --cyan: #00d4ff;
            --purple: #a855f7;
            --text: #e2e8f0;
            --muted: #94a3b8;
            --border: rgba(255,255,255,0.08);
            --error: #ef4444;
            --warn: #f59e0b;
            --ok: #22c55e;
        }
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            background-image: radial-gradient(circle at 20% 80%, rgba(0,212,255,0.03) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(168,85,247,0.03) 0%, transparent 50%);
            color: var(--text);
            min-height: 100vh;
            padding: 24px;
        }
        .glass { background: var(--card); backdrop-filter: blur(12px); border: 1px solid var(--border); border-radius: 12px; padding: 20px; transition: opacity 0.3s; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 16px; }
        h1 { font-size: 26px; font-weight: 600; background: linear-gradient(135deg, var(--cyan), var(--purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .meta { display: flex; gap: 20px; align-items: center; font-family: 'JetBrains Mono', monospace; font-size: 13px; color: var(--muted); }
        .live { color: var(--cyan); }
        .dot { width: 8px; height: 8px; border-radius: 50%; background: var(--cyan); animation: pulse 2s infinite; }
        @keyframes pulse { 0%,100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.2); } }
        .grid { display: grid; gap: 20px; margin-bottom: 24px; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
        .status-row { grid-column: 1 / -1; display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }
        @media (max-width: 1024px) { .status-row { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 640px) { .status-row { grid-template-columns: 1fr; } .grid { grid-template-columns: 1fr; } }
        .stat { text-align: center; }
        .stat .val { font-family: 'JetBrains Mono', monospace; font-size: 28px; font-weight: 500; color: var(--cyan); margin: 8px 0; }
        .stat .lbl { font-size: 11px; text-transform: uppercase; letter-spacing: 0.1em; color: var(--muted); }
        .panel-header { font-size: 12px; text-transform: uppercase; letter-spacing: 0.1em; color: var(--muted); margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
        .panel-header .pulse { width: 8px; height: 8px; border-radius: 50%; animation: pulse 2s infinite; }
        .pulse.green { background: var(--ok); }
        .pulse.amber { background: var(--warn); }
        .row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border); }
        .row:last-child { border-bottom: none; }
        .row .lbl { color: var(--muted); font-size: 13px; }
        .row .val { font-family: 'JetBrains Mono', monospace; font-size: 13px; }
        .row .val.error { color: var(--error); }
        .provider { display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; background: rgba(0,0,0,0.2); border-radius: 8px; margin-bottom: 8px; }
        .badge { padding: 3px 10px; border-radius: 20px; font-size: 10px; text-transform: uppercase; font-weight: 600; }
        .badge.ok { background: rgba(34,197,94,0.2); color: var(--ok); }
        .badge.missing { background: rgba(239,68,68,0.2); color: var(--error); }
        .skills { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 8px; }
        .skill { padding: 8px 12px; border-radius: 8px; font-size: 12px; font-weight: 500; text-align: center; transition: transform 0.2s; }
        .skill:hover { transform: translateY(-2px); }
        .skill.installed { background: rgba(0,212,255,0.15); color: var(--cyan); }
        .skill.missing { background: rgba(255,255,255,0.05); color: var(--muted); }
        .memory-content { font-family: 'JetBrains Mono', monospace; font-size: 12px; line-height: 1.6; max-height: 300px; overflow-y: auto; white-space: pre-wrap; color: var(--muted); }
        .memory-content::-webkit-scrollbar { width: 6px; }
        .memory-content::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
        .date-chips { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 12px; }
        .chip { padding: 4px 10px; border-radius: 20px; font-size: 11px; background: rgba(255,255,255,0.05); color: var(--muted); cursor: pointer; transition: all 0.2s; }
        .chip:hover, .chip.active { background: var(--cyan); color: #000; }
        .issue { padding: 10px 12px; border-radius: 6px; margin-bottom: 8px; font-size: 13px; font-family: 'JetBrains Mono', monospace; }
        .issue.error { background: rgba(239,68,68,0.1); border-left: 3px solid var(--error); }
        .issue.warning { background: rgba(245,158,11,0.1); border-left: 3px solid var(--warn); }
        .nominal { padding: 20px; text-align: center; color: var(--ok); font-size: 14px; }
        .provider-name { font-weight: 500; }
        .provider-msg { font-size: 11px; color: var(--muted); margin-right: 8px; }
        .progress-wrap { margin-bottom: 12px; }
        .progress-row { display:flex; justify-content:space-between; font-family:'JetBrains Mono',monospace; font-size:12px; margin-bottom:8px; color:var(--muted); }
        .progress-bar { height:8px; border-radius:999px; background:rgba(255,255,255,0.08); overflow:hidden; }
        .progress-fill { height:100%; width:0%; background:linear-gradient(90deg,var(--cyan),var(--purple)); transition:width .3s ease; }
        .todo-list { font-size:13px; display:flex; flex-direction:column; gap:8px; }
        .todo-item { padding:8px 10px; border-radius:8px; background:rgba(255,255,255,0.04); }
        .todo-item.done { opacity:.65; text-decoration:line-through; }
    </style>
</head>
<body>
    <header>
        <h1>OpenClaw Command Center</h1>
        <div class="meta">
            <span class="live" id="clock">--:--:--</span>
            <span id="last-refresh">--:--:--</span>
            <div style="display:flex;align-items:center;gap:8px;">
                <div class="dot"></div>
                <span id="countdown">30s</span>
            </div>
        </div>
    </header>

    <div class="grid">
        <div class="status-row">
            <div class="glass stat"><div class="lbl">CPU</div><div class="val" id="cpu">--%</div></div>
            <div class="glass stat"><div class="lbl">RAM</div><div class="val" id="ram">-- / -- GB</div></div>
            <div class="glass stat"><div class="lbl">Disk</div><div class="val" id="disk">-- / -- GB</div></div>
            <div class="glass stat"><div class="lbl">Uptime</div><div class="val" id="uptime">--</div></div>
        </div>

        <div class="glass">
            <div class="panel-header"><div class="pulse green" id="monitor-pulse"></div>Monitor State</div>
            <div class="row"><span class="lbl">Last Check</span><span class="val" id="last-check">--</span></div>
            <div class="row"><span class="lbl">Rate Limits</span><span class="val" id="rate-limits">--</span></div>
            <div class="row"><span class="lbl">Last Alert</span><span class="val" id="last-alert">--</span></div>
        </div>

        <div class="glass">
            <div class="panel-header">Provider Status</div>
            <div id="providers" style="font-size:12px;">Loading...</div>
        </div>

        <div class="glass" style="grid-column: 1 / -1;">
            <div class="panel-header">Skills Inventory</div>
            <div class="skills" id="skills">Loading...</div>
        </div>

        <div class="glass" style="grid-column: span 2;">
            <div class="panel-header">Memory Log <span id="mem-date" style="color:var(--cyan);"></span></div>
            <div class="date-chips" id="date-chips"></div>
            <div class="memory-content" id="memory-content">Loading...</div>
        </div>

        <div class="glass">
            <div class="panel-header">Alerts Panel</div>
            <div id="issues">Loading...</div>
        </div>

        <div class="glass" style="grid-column: 1 / -1;">
            <div class="panel-header">TODO / Progress</div>
            <div class="progress-wrap">
                <div class="progress-row"><span id="todo-summary">0 / 0 done</span><span id="todo-percent">0%</span></div>
                <div class="progress-bar"><div class="progress-fill" id="todo-fill"></div></div>
            </div>
            <div class="todo-list" id="todo-list">Loading...</div>
        </div>
    </div>

<script>
const REFRESH_INTERVAL = 30;
let nextRefresh = Date.now() + REFRESH_INTERVAL * 1000;

function fmtTime(d) {
    return new Date(d).toLocaleTimeString('en-US', {hour12: false, hour: '2-digit', minute:'2-digit', second:'2-digit'});
}

async function get(endpoint) {
    try { return await (await fetch('/api/' + endpoint)).json(); } catch(e) { return {}; }
}

async function load() {
    document.body.style.opacity = '0.7';
    const [s, m, p, sk, mem, is, td] = await Promise.all([
        get('status'), get('monitor'), get('providers'), get('skills'), get('memory'), get('issues'), get('todos')
    ]);

    document.getElementById('cpu').textContent = (s.cpu_percent ?? '--') + '%';
    document.getElementById('ram').textContent = (s.ram_gb ?? '--') + ' / ' + (s.ram_total_gb ?? '--') + ' GB';
    document.getElementById('disk').textContent = (s.disk_gb ?? '--') + ' / ' + (s.disk_total_gb ?? '--') + ' GB';
    document.getElementById('uptime').textContent = s.uptime ?? '--';

    document.getElementById('monitor-pulse').className = 'pulse ' + ((m.lastRateLimitCount||0)>0 ? 'amber' : 'green');
    document.getElementById('last-check').textContent = m.lastCheckAt ? fmtTime(m.lastCheckAt) : 'Never';
    document.getElementById('rate-limits').textContent = m.lastRateLimitCount ?? 0;
    document.getElementById('rate-limits').className = 'val ' + ((m.lastRateLimitCount||0)>0 ? 'error' : '');
    document.getElementById('last-alert').textContent = m.lastAlertAt ? fmtTime(m.lastAlertAt) : 'None';

    document.getElementById('providers').innerHTML = (p.providers||[]).map(x => `
        <div class="provider"><span class="provider-name">${x.name}</span>
        <div style="display:flex;align-items:center"><span class="provider-msg">${x.message}</span><span class="badge ${x.status}">${x.status}</span></div></div>
    `).join('');

    document.getElementById('skills').innerHTML = (sk.skills||[]).map(x =>
        `<div class="skill ${x.installed?'installed':'missing'}" title="${x.description||''}">${x.name}</div>`
    ).join('');

    document.getElementById('mem-date').textContent = mem.date ? '(' + mem.date + ')' : '';
    document.getElementById('memory-content').textContent = mem.content || 'No memory files';
    document.getElementById('date-chips').innerHTML = (mem.all_dates||[]).map(d =>
        `<div class="chip ${d===mem.date?'active':''}" onclick="switchMem('${d}')">${d}</div>`
    ).join('');

    const iel = document.getElementById('issues');
    if (is.nominal) iel.innerHTML = '<div class="nominal">All systems nominal</div>';
    else iel.innerHTML = (is.issues||[]).map(i => `<div class="issue ${i.level}">${i.message}</div>`).join('');

    document.getElementById('todo-summary').textContent = `${td.done ?? 0} / ${td.total ?? 0} done`;
    document.getElementById('todo-percent').textContent = `${td.percent ?? 0}%`;
    document.getElementById('todo-fill').style.width = `${td.percent ?? 0}%`;
    const tel = document.getElementById('todo-list');
    tel.innerHTML = (td.items||[]).length
      ? (td.items||[]).map(t => `<div class="todo-item ${t.done ? 'done' : ''}">${t.done ? '✅' : '⬜'} ${t.text}</div>`).join('')
      : '<div class="nominal">No TODO items yet</div>';

    document.getElementById('last-refresh').textContent = fmtTime(new Date());
    nextRefresh = Date.now() + REFRESH_INTERVAL * 1000;
    document.body.style.opacity = '1';
}

async function switchMem(date) {
    const d = await get('memory?date=' + date);
    document.getElementById('memory-content').textContent = d.content || 'No data';
    document.getElementById('mem-date').textContent = '(' + (d.date||'') + ')';
    document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
    event.target.classList.add('active');
}

setInterval(() => {
    document.getElementById('clock').textContent = fmtTime(new Date());
    document.getElementById('countdown').textContent = Math.max(0, Math.ceil((nextRefresh-Date.now())/1000)) + 's';
}, 1000);

setInterval(load, REFRESH_INTERVAL * 1000);
load();
</script>
</body>
</html>
